:root{
  --bg:#fbfbfb;--panel:#f3f3f4;--hover:#eeeeef;
  --panel-hover:#e7e7e9;--selected:#dddde0;
  --text:#333;--text-2:#9aa3ac
}
body[data-theme="dark"]{
  --bg:#1a1a1a;--panel:#121212;--hover:#242424;
  --panel-hover:#1d1d1d;--selected:#2c2c2c;
  --text:#e0e0e0;--text-2:#a0a0a0
}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text);transition:background 0.1s,color 0.1s}
.app{display:flex;height:100vh}

/* sidebar */
.sidebar{width:300px;background:var(--panel);padding:12px;overflow:auto}
.header{font-weight:700;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.theme-toggle{
  width:24px;
  height:24px;
  border:none;
  border-radius:4px;
  background:var(--text);
  cursor:pointer;
  transition:box-shadow 0.2s;
}
.theme-toggle:hover{
  box-shadow:0 0 0 2px var(--text-2);
}
.tree{list-style:none;padding:0;margin:0}
.cat-title{font-weight:600;padding:6px;border-radius:6px;cursor:pointer}
.cat-title:hover{background:var(--panel-hover)}
.channels{display:none;list-style:none;padding-left:12px}
.channel{padding:4px;border-radius:6px;cursor:pointer;color:var(--text-2);display:flex}
.channel:hover{background:var(--panel-hover)}
.channel.selected{background:var(--selected);color:var(--text)}
.channel-icon-wrapper{
  display:inline-flex;
  align-items:center;
  width:16px;
  flex-shrink:0;
  font-size:12px;
}
.channel-content{display:inline;word-break:break-word}

/* threads in sidebar */
.threads{list-style:none;padding-left:24px;margin-top:4px;margin-bottom:4px}
.thread{
  padding:4px;
  border-radius:6px;
  cursor:pointer;
  color:var(--text-2);
  font-size:13px;
}
.thread:hover{background:var(--panel-hover)}
.thread.selected{background:var(--selected);color:var(--text)}

/* main */
.main{flex:1;display:flex;flex-direction:column;min-width:40vw;position:relative}
.topbar{height:30px;padding:12px;border-bottom:1px solid #0002;display:flex;align-items:center;justify-content:space-between;gap:8px}
.topbar-search{display:flex;align-items:center;gap:6px;position:relative}
.topbar-search input{padding:6px 10px 6px 10px;padding-right:30px;border:1px solid #0002;border-radius:4px;background:var(--bg);color:var(--text);font-size:13px;width:200px}
.topbar-search input::placeholder{color:var(--text-2);font-size:12px}
.topbar-search button{display:none}
.search-icon{
  position:absolute;
  right:8px;
  color:var(--text-2);
  font-size:14px;
  cursor:text;
  user-select:none;
  padding:4px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:color 0.2s;
  z-index:2;
}
.search-icon.closable{
  cursor:pointer;
}
.search-icon.closable:hover{
  color:var(--text);
}

/* search input highlight */
.search-input-wrapper{
  position:relative;
  display:flex;
  align-items:center;
  gap:6px;
}
.search-input-highlight{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  padding:6px 10px;
  border-radius:4px;
  font-size:13px;
  overflow:hidden;
  white-space:nowrap;
  color:transparent;
  z-index:-1;
}
.search-input-highlight mark{
  background:var();
  color:transparent;
  border-radius:2px;
}
#searchInput{
  position:relative;
  z-index:1;
  background:transparent;
  width:200px;
  padding-right:30px;
}
.messages{
  flex:1;
  overflow:auto;
  padding:12px;
  min-width:0;
  display:flex;
  flex-direction:column;
}

/* thread panel */
.thread-panel{
  width:400px;
  background:var(--panel);
  display:none;
  flex-direction:column;
  border-left:1px solid #0002;
  flex-shrink:0;
}
.thread-panel.active{
  display:flex;
}
.thread-topbar{
  height:30px;
  padding:12px;
  border-bottom:1px solid #0002;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.thread-close{
  cursor:pointer;
  font-size:18px;
  color:var(--text-2);
  padding:4px 8px;
  border-radius:4px;
}
.thread-close:hover{
  background:var(--hover);
}
.thread-messages{
  flex:1;
  overflow:auto;
  padding:12px;
}

/* search panel */
.search-panel{
  width:450px;
  background:var(--panel);
  display:none;
  flex-direction:column;
  border-left:1px solid #0002;
  flex-shrink:0;
}
.search-panel.active{
  display:flex;
}
.search-topbar{
  height:30px;
  padding:12px;
  border-bottom:1px solid #0002;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.search-close{
  cursor:pointer;
  font-size:18px;
  color:var(--text-2);
  padding:4px 8px;
  border-radius:4px;
}
.search-close:hover{
  background:var(--hover);
}
.search-results{
  flex:1;
  overflow:auto;
  padding:12px;
}
.search-result-header{
  padding:12px 6px 6px 6px;
  font-weight:600;
  font-size:13px;
  color:var(--text-2);
}

/* message */
.msg-container{display:flex;flex-direction:column;gap:2px;padding:6px;border-radius:6px}
.msg-container:hover{background:var(--hover)}
.msg-content-wrapper{display:flex;gap:10px}
.msg-side{display:flex;align-items:center;justify-content:center;width:36px;height:36px}
.msg-side img{width:36px;height:36px;border-radius:50%;object-fit:cover}
.msg-side .msg-time{font-size:11px;color:var(--text-2);text-align:center;opacity:0;transition:opacity 0.2s}
.msg-container:hover .msg-side .msg-time{opacity:1}
.msg-header{font-size:13px;font-weight:600}
.msg-header-name{font-size:15px;font-weight:600;margin-right:8px}
.msg-header-time{font-size:12px;color:var(--text-2)}
.content{white-space:pre-wrap;word-break:break-word}
.content img{max-width:60%;border-radius:6px;margin-top:6px;max-height:40vh;cursor:pointer}
/* ===== reply表示 ===== */
.reply-block{
  height:18px;
  font-size:12px;
  color:var(--text-2);
  margin-bottom:0;
  margin-left:0;
  padding-left:8px;
  cursor:pointer;
  position:relative;
  display:flex;
  gap:10px;
}

.reply-block-header{
  width:36px;
  flex-shrink:0;
  position:relative;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding-top:2px;
}
.reply-block-header .line{
  position:absolute;
  top:7px;
  left:8px;
  width:18px;
  height:10px;
  display:block;
  border-left:2px solid var(--text-2);
  border-top:2px solid var(--text-2);
  border-top-left-radius:7px;
  box-sizing:border-box;
}
.reply-block:hover .reply-block-header .line{
  border-left:2px solid var(--text);
  border-top:2px solid var(--text);
}

.reply-block-content{
  flex:1;
  display:flex;
  flex-direction:row;
  align-items:center;
  gap:6px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.reply-block-content img.reply-avatar{
  width:16px;
  height:16px;
  border-radius:50%;
  object-fit:cover;
  flex-shrink:0;
}

/* mentions */
.mention{
  padding:2px 4px;
  border-radius:4px;
  font-weight:600;
}
.mention.user{
  background:#5865f21a;
  color:#5865f2;
}
.mention.everyone{
  background:#f047471a;
  color:#f04747;
}

/* links */
.mention a{
  text-decoration:none;
}
.mention a:hover{
  text-decoration:underline;
}

/* poll */
.poll{
  border:1px solid var(--panel-hover);
  border-radius:8px;
  padding:12px;
  margin-top:8px;
  background:var(--panel);
}
.poll-question{
  font-weight:600;
  margin-bottom:12px;
}
.poll-answer{
  padding:8px;
  margin:4px 0;
  border-radius:6px;
  background:var(--hover);
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:relative;
  overflow:hidden;
}
.poll-answer-bar{
  position:absolute;
  left:0;
  top:0;
  height:100%;
  background:rgba(88,165,242,0.2);
  border-radius:6px;
  z-index:0;
}
.poll-answer-text{
  flex:1;
  position:relative;
  z-index:1;
}
.poll-answer-votes{
  color:var(--text-2);
  font-size:12px;
  margin-left:8px;
  position:relative;
  z-index:1;
}

/* server header */
.server-header{
  display:none;
  align-items:center;
  gap:8px;
  padding:6px;
  background:var(--panel);
  border-radius:6px;
  margin-bottom:8px
}
.server-header img{width:40px;height:40px;border-radius:6px}

/* modal */
.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.8);
  z-index:1000;
  align-items:center;
  justify-content:center;
}
.modal.active{
  display:flex;
}
.modal-content{
  max-width:90vw;
  max-height:90vh;
  object-fit:contain;
  border-radius:8px;
}

/* search panel */
.search-panel{
  width:400px;
  background:var(--panel);
  display:none;
  flex-direction:column;
  border-left:1px solid #0002;
  flex-shrink:0;
}
.search-panel.active{
  display:flex;
}
.search-topbar{
  height:30px;
  padding:12px;
  border-bottom:1px solid #0002;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:600;
}
.search-close{
  cursor:pointer;
  font-size:18px;
  color:var(--text-2);
  padding:4px 8px;
}
.search-close:hover{
  color:var(--text);
}
.search-results{
  flex:1;
  overflow:auto;
}
.search-result-item{
  padding:8px 12px;
  border-bottom:1px solid var(--panel-hover);
  cursor:pointer;
  transition:background 0.2s;
}
.search-result-item:hover{
  background:var(--hover);
}
.search-result-preview-image{
  width:100%;
  max-width:200px;
  border-radius:4px;
  margin-top:6px;
  cursor:pointer;
  object-fit:cover;
}

.storage-btn{
  flex:1;
  padding:6px;
  border:none;
  border-radius:4px;
  background:var(--panel);
  cursor:pointer;
  font-size:13px;
  color:var(--text);
  transition:all 0.2s;
}
.storage-btn.active{
  background:var(--selected);
  font-weight:600;
}
.storage-btn:hover{
  background:var(--hover);
}

.reload-btn{
  padding:8px 12px;
  border:none;
  border-radius:4px;
  background:var(--panel);
  cursor:pointer;
  font-size:13px;
  color:var(--text);
  transition:all 0.2s;
  display:none;
  margin-top:8px;
}
.reload-btn:hover{
  background:var(--hover);
}

/* user suggestions */
.user-suggestions{
  position:absolute;
  top:calc(100% + 4px);
  left:0;
  width:250px;
  max-height:300px;
  overflow:auto;
  background:var(--panel);
  border:1px solid var(--panel-hover);
  border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  z-index:10;
  display:none;
}
.user-suggestion{
  padding:8px 12px;
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  font-size:14px;
  transition:background 0.15s;
}
.user-suggestion:hover{
  background:var(--hover);
}
.user-suggestion:first-child{
  border-radius:6px 6px 0 0;
}
.user-suggestion:last-child{
  border-radius:0 0 6px 6px;
}
.user-suggestion img{
  width:28px;
  height:28px;
  border-radius:50%;
  object-fit:cover;
  flex-shrink:0;
}
.user-suggestion-placeholder{
  width:28px;
  height:28px;
  border-radius:50%;
  background:var(--panel-hover);
  flex-shrink:0;
}
.user-suggestion-name{
  flex:1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  color:var(--text);
}
.main-content{
  flex:1;
  display:flex;
  flex-direction: row;
  overflow:hidden;
}

/* date picker */
.date-picker{
  position:absolute;
  top:calc(100% + 4px);
  left:0;
  width:280px;
  background:var(--panel);
  border:1px solid var(--panel-hover);
  border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  z-index:10;
  display:none;
  padding:12px;
}
.date-picker-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.date-picker-nav{
  cursor:pointer;
  padding:4px 8px;
  border-radius:4px;
  user-select:none;
}
.date-picker-nav:hover{
  background:var(--hover);
}
.date-picker-title{
  font-weight:600;
  font-size:14px;
}
.date-picker-weekdays{
  display:grid;
  grid-template-columns:repeat(7, 1fr);
  gap:4px;
  margin-bottom:4px;
}
.date-picker-weekday{
  text-align:center;
  font-size:11px;
  color:var(--text-2);
  padding:4px;
}
.date-picker-days{
  display:grid;
  grid-template-columns:repeat(7, 1fr);
  gap:4px;
}
.date-picker-day{
  text-align:center;
  padding:6px;
  border-radius:4px;
  cursor:pointer;
  font-size:13px;
  transition:background 0.15s;
}
.date-picker-day:hover{
  background:var(--hover);
}
.date-picker-day.other-month{
  color:var(--text-2);
  opacity:0.5;
}
.date-picker-day.selected{
  background:var(--selected);
  font-weight:600;
}
.date-picker-day.today{
  border:1px solid var(--text-2);
}

/* ===== general ===== */
.hide{display:none}
.show{display:block}
.flex{display:flex}
.items-center{align-items:center}
.justify-between{justify-content:space-between}
.p-4{padding:16px}
.pb-4{padding-bottom:16px}
.pt-4{padding-top:16px}
.pl-4{padding-left:16px}
.pr-4{padding-right:16px}
.m-0{margin:0}
.mt-0{margin-top:0}
.mb-0{margin-bottom:0}
.ml-auto{margin-left:auto}
.mr-auto{margin-right:auto}
.rounded{border-radius:4px}
.cursor-pointer{cursor:pointer}
.text-center{text-align:center}
.text-right{text-align:right}
.text-left{text-align:left}
.font-bold{font-weight:700}
.font-semibold{font-weight:600}
.text-xs{font-size:12px}
.text-sm{font-size:14px}
.text-base{font-size:16px}
.text-lg{font-size:18px}
.text-xl{font-size:20px}
.leading-tight{line-height:1.25}
.leading-normal{line-height:1.5}
.leading-loose{line-height:1.75}
.overflow-hidden{overflow:hidden}
.overflow-auto{overflow:auto}
.whitespace-nowrap{white-space:nowrap}
.break-words{word-break:break-word}
.text-gray-500{color:#999}
.text-gray-700{color:#333}
.bg-gray-100{background:#f7f7f7}
.bg-gray-200{background:#eee}
.border-gray-200{border-color:#eee}
.border-t{border-top:1px solid}
.border-b{border-bottom:1px solid}
.shadow{box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.transition{transition:all 0.2s}
.rotate-180{transform:rotate(180deg)}
.scale-95{transform:scale(0.95)}
.scale-100{transform:scale(1)}
.scale-105{transform:scale(1.05)}
.scale-110{transform:scale(1.1)}

/* ===== mobile menu ===== */
.menu-toggle{
  display:none;
  position:fixed;
  top:12px;
  left:12px;
  z-index:1001;
  width:40px;
  height:40px;
  border:none;
  border-radius:8px;
  background:var(--panel);
  color:var(--text);
  font-size:20px;
  cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}
.menu-toggle:hover{
  background:var(--hover);
}
.menu-toggle-mobile{
  display:none;
  width:32px;
  height:32px;
  border:none;
  border-radius:6px;
  background:transparent;
  color:var(--text);
  font-size:18px;
  cursor:pointer;
  flex-shrink:0;
}
.menu-toggle-mobile:hover{
  background:var(--hover);
}
.sidebar-overlay{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  z-index:999;
}
.sidebar-overlay.active{
  display:block;
}
.sidebar-close{
  display:none;
  width:28px;
  height:28px;
  border:none;
  border-radius:4px;
  background:transparent;
  color:var(--text-2);
  font-size:18px;
  cursor:pointer;
}
.sidebar-close:hover{
  background:var(--hover);
  color:var(--text);
}
.header-buttons{
  display:flex;
  align-items:center;
  gap:8px;
}

/* ===== mobile responsive ===== */
@media (max-width: 768px){
  .menu-toggle-mobile{
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .sidebar{
    position:fixed;
    top:0;
    left:-100%;
    width:85%;
    max-width:320px;
    height:100%;
    z-index:1000;
    transition:left 0.3s ease;
    box-shadow:2px 0 12px rgba(0,0,0,0.2);
  }
  .sidebar.active{
    left:0;
  }
  .sidebar-close{
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .main{
    min-width:100vw;
    width:100vw;
  }
  .topbar{
    padding:8px 12px;
    gap:6px;
  }
  .topbar-search{
    flex:1;
  }
  .topbar-search input{
    width:100%;
    min-width:0;
  }
  #searchInput{
    width:100%;
  }
  .thread-panel{
    position:fixed;
    top:0;
    right:-100%;
    width:100%;
    height:100%;
    z-index:998;
    transition:right 0.3s ease;
    border-left:none;
  }
  .thread-panel.active{
    right:0;
  }
  .search-panel{
    position:fixed;
    top:0;
    right:-100%;
    width:100%;
    height:100%;
    z-index:998;
    transition:right 0.3s ease;
    border-left:none;
  }
  .search-panel.active{
    right:0;
  }
  .messages{
    padding:8px;
  }
  .msg-side{
    width:32px;
    height:32px;
  }
  .msg-side img{
    width:32px;
    height:32px;
  }
  .content img{
    max-width:100%;
  }
  .user-suggestions{
    width:calc(100vw - 48px);
    max-width:280px;
  }
  .date-picker{
    width:calc(100vw - 48px);
    max-width:280px;
  }
}

@media (max-width: 480px){
  .sidebar{
    width:100%;
    max-width:100%;
  }
  .msg-header-name{
    font-size:14px;
  }
  .msg-header-time{
    font-size:11px;
  }
  .content{
    font-size:14px;
  }
  .topbar{
    flex-wrap:wrap;
  }
  #roomTitle{
    font-size:14px;
    flex:1;
    min-width:0;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }
}
